name: Test

"on":
  push:
    branches: master
  pull_request:

jobs:
  build-Dockerfile:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build
      with:
        dockerfile: Dockerfile

  build-Dockerfile-testing:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/build
      with:
        dockerfile: Dockerfile.testing

  test-Dockerfile:
    needs: build-Dockerfile
    runs-on: ubuntu-latest
    strategy:
      matrix:
        network: [testnet, pubnet, standalone]
        options: ["", --enable-horizon-captive-core]
        exclude:
          - network: testnet
            options: --enable-horizon-captive-core
          - network: pubnet
            options: --enable-horizon-captive-core
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/test
      with:
        dockerfile: Dockerfile.testing
        network: ${{ matrix.network }}
        options: ${{ matrix.options }}

  test-Dockerfile-testing:
    needs: build-Dockerfile-testing
    strategy:
      matrix:
        network: [testnet, pubnet, standalone]
        options: ["", --enable-horizon-captive-core]
        exclude:
          - network: testnet
            options: --enable-horizon-captive-core
          - network: pubnet
            options: --enable-horizon-captive-core
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: ./.github/actions/test
      with:
        dockerfile: Dockerfile.testing
        network: ${{ matrix.network }}
        options: ${{ matrix.options }}
