name: 'Push Manifest'
inputs:
  head_sha:
    required: true
  image:
    required: true
  images:
    required: true
  registry:
    required: true
    default: ghcr.io
  username:
    required: true
    default: ${{ github.actor }}
  password:
    required: true
    default: ${{ github.token }}
runs:
  using: "composite"
  steps:
    - 
      uses: docker/login-action@5e57cd118135c172c3672efd75eb46360885c0ef # v3.6.0
      with:
        registry: ${{ inputs.registry }}
        username: ${{ inputs.username }}
        password: ${{ inputs.password }}
    - 
      shell: bash
      run: >
        docker manifest create
        ${{ inputs.image }}
        ${{ inputs.image }}-amd64
        ${{ inputs.image }}-arm64
    - 
      shell: bash
      run: >
        docker manifest push
        ${{ inputs.image }}
    - 
      uses: actions/github-script@v5
      with:
        script: |
          github.rest.repos.createCommitStatus({
            owner: context.repo.owner,
            repo: context.repo.repo,
            sha: '${{ inputs.head_sha }}',
            state: 'success',
            context: `${{ inputs.image }}`,
            description: 'Available',
          });
