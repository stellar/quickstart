#! /usr/bin/env bash
set -e

# dependencies
export DEBIAN_FRONTEND=noninteractive

# Add PostgreSQL APT repository for PostgreSQL 14
apt-get update
apt-get install -y curl ca-certificates lsb-release
install -d /usr/share/postgresql-common/pgdg
curl -o /usr/share/postgresql-common/pgdg/apt.postgresql.org.asc --fail https://www.postgresql.org/media/keys/ACCC4CF8.asc
. /etc/os-release
sh -c "echo 'deb [signed-by=/usr/share/postgresql-common/pgdg/apt.postgresql.org.asc] https://apt.postgresql.org/pub/repos/apt ${VERSION_CODENAME}-pgdg main' > /etc/apt/sources.list.d/pgdg.list"

apt-get update
apt-get install -y curl apt-transport-https \
                   postgresql-client-14 postgresql-14 postgresql-contrib \
                   sudo supervisor psmisc \
                   nginx rsync jq netcat-openbsd \
                   libunwind8 sqlite3 libc++abi1-20 libc++1-20
apt-get clean
rm -rf /var/lib/apt/lists/*

chown -R www-data:www-data /var/lib/nginx

echo "\nDone installing dependencies...\n"
