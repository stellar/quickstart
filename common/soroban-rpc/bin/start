#! /bin/bash

set -e
set -o pipefail

while ! (curl -sf http://localhost:8001/ | jq --exit-status '.current_protocol_version > 0'); do
  echo "Waiting for horizon to be available..."
  sleep 1
done

echo "starting soroban-rpc..."
source /opt/stellar/soroban-rpc/etc/soroban-rpc.env
exec /usr/local/bin/soroban-rpc
